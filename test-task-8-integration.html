<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task 8: Cross-Browser Integration Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      color: #e2e8f0;
      padding: 2rem;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #ec4899, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.1rem;
      color: #94a3b8;
      margin-bottom: 2rem;
    }

    .test-section {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(236, 72, 153, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .test-section h2 {
      font-size: 1.5rem;
      color: #ec4899;
      margin-bottom: 1rem;
    }

    .test-item {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .test-name {
      flex: 1;
      font-size: 0.95rem;
    }

    .test-status {
      padding: 0.4rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      min-width: 100px;
      text-align: center;
    }

    .status-pending {
      background: rgba(100, 116, 139, 0.3);
      color: #94a3b8;
    }

    .status-running {
      background: rgba(59, 130, 246, 0.3);
      color: #60a5fa;
      animation: pulse 1.5s ease-in-out infinite;
    }

    .status-pass {
      background: rgba(34, 197, 94, 0.3);
      color: #4ade80;
    }

    .status-fail {
      background: rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .test-details {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-top: 0.5rem;
      padding-left: 1rem;
      border-left: 2px solid rgba(236, 72, 153, 0.3);
    }

    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: 1px solid rgba(236, 72, 153, 0.5);
      border-radius: 8px;
      background: rgba(236, 72, 153, 0.2);
      color: #ec4899;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: rgba(236, 72, 153, 0.3);
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .summary {
      background: rgba(236, 72, 153, 0.1);
      border: 2px solid rgba(236, 72, 153, 0.5);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .summary h3 {
      font-size: 1.3rem;
      color: #ec4899;
      margin-bottom: 1rem;
    }

    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }

    .stat {
      text-align: center;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 8px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .stat-label {
      font-size: 0.85rem;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .console-output {
      background: #0f172a;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
    }

    .console-line {
      margin-bottom: 0.25rem;
      padding: 0.25rem;
    }

    .console-info {
      color: #60a5fa;
    }

    .console-success {
      color: #4ade80;
    }

    .console-error {
      color: #f87171;
    }

    .console-warn {
      color: #fbbf24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Task 8: Cross-Browser Integration Test</h1>
    <p class="subtitle">Comprehensive testing for music page enhancements</p>

    <div class="controls">
      <button class="btn" id="run-all-btn">‚ñ∂ Run All Tests</button>
      <button class="btn" id="clear-btn">üóëÔ∏è Clear Results</button>
    </div>

    <!-- Test Section 1: Translation System -->
    <div class="test-section">
      <h2>1. Translation System Tests</h2>
      <div id="translation-tests"></div>
    </div>

    <!-- Test Section 2: Modal Functionality -->
    <div class="test-section">
      <h2>2. Modal Functionality Tests</h2>
      <div id="modal-tests"></div>
    </div>

    <!-- Test Section 3: Player Integration -->
    <div class="test-section">
      <h2>3. Player Integration Tests</h2>
      <div id="player-tests"></div>
    </div>

    <!-- Test Section 4: Accessibility Tests -->
    <div class="test-section">
      <h2>4. Accessibility Tests</h2>
      <div id="accessibility-tests"></div>
    </div>

    <!-- Test Section 5: Browser Compatibility -->
    <div class="test-section">
      <h2>5. Browser Compatibility Tests</h2>
      <div id="browser-tests"></div>
    </div>

    <!-- Summary -->
    <div class="summary" id="summary" style="display: none;">
      <h3>üìä Test Summary</h3>
      <div class="summary-stats">
        <div class="stat">
          <div class="stat-value" id="total-tests">0</div>
          <div class="stat-label">Total Tests</div>
        </div>
        <div class="stat">
          <div class="stat-value" style="color: #4ade80;" id="passed-tests">0</div>
          <div class="stat-label">Passed</div>
        </div>
        <div class="stat">
          <div class="stat-value" style="color: #f87171;" id="failed-tests">0</div>
          <div class="stat-label">Failed</div>
        </div>
        <div class="stat">
          <div class="stat-value" style="color: #ec4899;" id="success-rate">0%</div>
          <div class="stat-label">Success Rate</div>
        </div>
      </div>
    </div>

    <!-- Console Output -->
    <div class="test-section">
      <h2>üìù Console Output</h2>
      <div class="console-output" id="console-output"></div>
    </div>
  </div>

  <script>
    // Test framework
    const TestRunner = {
      tests: [],
      results: {
        total: 0,
        passed: 0,
        failed: 0
      },

      addTest(category, name, testFn, requirements) {
        this.tests.push({ category, name, testFn, requirements });
      },

      async runAll() {
        this.log('Starting test suite...', 'info');
        this.results = { total: 0, passed: 0, failed: 0 };

        for (const test of this.tests) {
          await this.runTest(test);
        }

        this.showSummary();
        this.log('Test suite completed!', 'success');
      },

      async runTest(test) {
        const testId = `test-${test.category}-${this.results.total}`;
        this.updateTestStatus(testId, 'running');
        this.log(`Running: ${test.name}`, 'info');

        try {
          const result = await test.testFn();
          this.results.total++;
          
          if (result.pass) {
            this.results.passed++;
            this.updateTestStatus(testId, 'pass', result.message);
            this.log(`‚úì PASS: ${test.name}`, 'success');
          } else {
            this.results.failed++;
            this.updateTestStatus(testId, 'fail', result.message);
            this.log(`‚úó FAIL: ${test.name} - ${result.message}`, 'error');
          }
        } catch (error) {
          this.results.total++;
          this.results.failed++;
          this.updateTestStatus(testId, 'fail', error.message);
          this.log(`‚úó ERROR: ${test.name} - ${error.message}`, 'error');
        }

        // Small delay between tests
        await this.delay(100);
      },

      updateTestStatus(testId, status, message = '') {
        const testEl = document.getElementById(testId);
        if (!testEl) return;

        const statusEl = testEl.querySelector('.test-status');
        statusEl.className = `test-status status-${status}`;
        statusEl.textContent = status.toUpperCase();

        if (message) {
          let detailsEl = testEl.querySelector('.test-details');
          if (!detailsEl) {
            detailsEl = document.createElement('div');
            detailsEl.className = 'test-details';
            testEl.appendChild(detailsEl);
          }
          detailsEl.textContent = message;
        }
      },

      showSummary() {
        const summary = document.getElementById('summary');
        summary.style.display = 'block';

        document.getElementById('total-tests').textContent = this.results.total;
        document.getElementById('passed-tests').textContent = this.results.passed;
        document.getElementById('failed-tests').textContent = this.results.failed;
        
        const successRate = this.results.total > 0 
          ? Math.round((this.results.passed / this.results.total) * 100) 
          : 0;
        document.getElementById('success-rate').textContent = successRate + '%';
      },

      log(message, type = 'info') {
        const console = document.getElementById('console-output');
        const line = document.createElement('div');
        line.className = `console-line console-${type}`;
        line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        console.appendChild(line);
        console.scrollTop = console.scrollHeight;
      },

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    };

    // Helper function to create test items
    function createTestItem(category, name, requirements) {
      const container = document.getElementById(`${category}-tests`);
      const testId = `test-${category}-${TestRunner.results.total}`;
      
      const item = document.createElement('div');
      item.className = 'test-item';
      item.id = testId;
      item.innerHTML = `
        <div class="test-name">
          ${name}
          ${requirements ? `<br><small style="color: #64748b;">Requirements: ${requirements}</small>` : ''}
        </div>
        <div class="test-status status-pending">PENDING</div>
      `;
      
      container.appendChild(item);
    }

    // Define all tests
    function defineTests() {
      // Translation System Tests
      TestRunner.addTest('translation', 'Translation files load correctly', async () => {
        createTestItem('translation', 'Translation files load correctly', '1.1, 1.2');
        
        const response = await fetch('locales/music.json');
        if (!response.ok) {
          return { pass: false, message: 'Failed to load music.json' };
        }
        
        const translations = await response.json();
        const hasAllLangs = translations.en && translations.pl && translations.nl;
        
        return {
          pass: hasAllLangs,
          message: hasAllLangs ? 'All languages present' : 'Missing language(s)'
        };
      }, '1.1, 1.2');

      TestRunner.addTest('translation', 'All required translation keys exist', async () => {
        createTestItem('translation', 'All required translation keys exist', '1.1, 1.3');
        
        const response = await fetch('locales/music.json');
        const translations = await response.json();
        
        const requiredKeys = [
          'page_title', 'page_description', 'playlist_title',
          'filter_all', 'filter_film', 'filter_electronic',
          'track_info_title', 'track_info_close', 'track_info_no_description',
          'track_info_year', 'track_info_duration', 'track_info_tags'
        ];
        
        const missingKeys = [];
        for (const lang of ['en', 'pl', 'nl']) {
          for (const key of requiredKeys) {
            if (!translations[lang][key]) {
              missingKeys.push(`${lang}.${key}`);
            }
          }
        }
        
        return {
          pass: missingKeys.length === 0,
          message: missingKeys.length === 0 
            ? 'All keys present' 
            : `Missing: ${missingKeys.join(', ')}`
        };
      }, '1.1, 1.3');

      // Modal Functionality Tests
      TestRunner.addTest('modal', 'Modal HTML structure exists', async () => {
        createTestItem('modal', 'Modal HTML structure exists', '2.1, 2.3');
        
        // Open music.html in iframe to test
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = 'music.html';
        document.body.appendChild(iframe);
        
        await TestRunner.delay(2000); // Wait for page load
        
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        const modal = iframeDoc.getElementById('track-info-modal');
        const backdrop = iframeDoc.getElementById('track-info-backdrop');
        const closeBtn = iframeDoc.getElementById('track-info-close');
        
        document.body.removeChild(iframe);
        
        const exists = modal && backdrop && closeBtn;
        return {
          pass: exists,
          message: exists ? 'Modal structure complete' : 'Missing modal elements'
        };
      }, '2.1, 2.3');

      TestRunner.addTest('modal', 'Modal has proper ARIA attributes', async () => {
        createTestItem('modal', 'Modal has proper ARIA attributes', '2.4, 3.4');
        
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = 'music.html';
        document.body.appendChild(iframe);
        
        await TestRunner.delay(2000);
        
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        const modal = iframeDoc.getElementById('track-info-modal');
        
        const hasRole = modal?.getAttribute('role') === 'dialog';
        const hasAriaModal = modal?.getAttribute('aria-modal') === 'true';
        const hasAriaLabel = modal?.hasAttribute('aria-labelledby');
        
        document.body.removeChild(iframe);
        
        const valid = hasRole && hasAriaModal && hasAriaLabel;
        return {
          pass: valid,
          message: valid ? 'All ARIA attributes present' : 'Missing ARIA attributes'
        };
      }, '2.4, 3.4');

      // Player Integration Tests
      TestRunner.addTest('player', 'Audio player element exists', async () => {
        createTestItem('player', 'Audio player element exists', '4.1, 4.4');
        
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = 'music.html';
        document.body.appendChild(iframe);
        
        await TestRunner.delay(2000);
        
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        const audio = iframeDoc.getElementById('audio-player');
        const playerBar = iframeDoc.getElementById('player-bar');
        
        document.body.removeChild(iframe);
        
        const exists = audio && playerBar;
        return {
          pass: exists,
          message: exists ? 'Player elements found' : 'Missing player elements'
        };
      }, '4.1, 4.4');

      TestRunner.addTest('player', 'Track data loads from JSON', async () => {
        createTestItem('player', 'Track data loads from JSON', '4.1');
        
        const response = await fetch('assets/audio/tracks.json');
        if (!response.ok) {
          return { pass: false, message: 'Failed to load tracks.json' };
        }
        
        const tracks = await response.json();
        const isArray = Array.isArray(tracks);
        const hasData = tracks.length > 0;
        
        return {
          pass: isArray && hasData,
          message: isArray && hasData 
            ? `Loaded ${tracks.length} tracks` 
            : 'Invalid track data'
        };
      }, '4.1');

      // Accessibility Tests
      TestRunner.addTest('accessibility', 'Info buttons have proper labels', async () => {
        createTestItem('accessibility', 'Info buttons have proper labels', '3.1, 4.3');
        
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = 'music.html';
        document.body.appendChild(iframe);
        
        await TestRunner.delay(3000); // Wait for playlist render
        
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        const infoButtons = iframeDoc.querySelectorAll('.playlist-info-btn');
        
        let allHaveLabels = true;
        infoButtons.forEach(btn => {
          if (!btn.hasAttribute('aria-label') && !btn.hasAttribute('data-i18n-aria-label')) {
            allHaveLabels = false;
          }
        });
        
        document.body.removeChild(iframe);
        
        return {
          pass: allHaveLabels && infoButtons.length > 0,
          message: allHaveLabels 
            ? `${infoButtons.length} buttons with labels` 
            : 'Missing aria-label attributes'
        };
      }, '3.1, 4.3');

      TestRunner.addTest('accessibility', 'Close button meets size requirements', async () => {
        createTestItem('accessibility', 'Close button meets size requirements', '3.1');
        
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = 'music.html';
        document.body.appendChild(iframe);
        
        await TestRunner.delay(2000);
        
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        const closeBtn = iframeDoc.getElementById('track-info-close');
        
        if (!closeBtn) {
          document.body.removeChild(iframe);
          return { pass: false, message: 'Close button not found' };
        }
        
        const styles = iframe.contentWindow.getComputedStyle(closeBtn);
        const width = parseInt(styles.width);
        const height = parseInt(styles.height);
        
        document.body.removeChild(iframe);
        
        const meetsSize = width >= 44 && height >= 44;
        return {
          pass: meetsSize,
          message: meetsSize 
            ? `${width}x${height}px (meets 44x44px minimum)` 
            : `${width}x${height}px (below 44x44px minimum)`
        };
      }, '3.1');

      // Browser Compatibility Tests
      TestRunner.addTest('browser', 'CSS backdrop-filter support', async () => {
        createTestItem('browser', 'CSS backdrop-filter support', '2.5');
        
        const supported = CSS.supports('backdrop-filter', 'blur(10px)') || 
                         CSS.supports('-webkit-backdrop-filter', 'blur(10px)');
        
        return {
          pass: supported,
          message: supported 
            ? 'Backdrop filter supported' 
            : 'Backdrop filter not supported (fallback needed)'
        };
      }, '2.5');

      TestRunner.addTest('browser', 'ES6+ JavaScript features', async () => {
        createTestItem('browser', 'ES6+ JavaScript features', '4.1');
        
        try {
          // Test arrow functions
          const arrow = () => true;
          // Test template literals
          const template = `test`;
          // Test const/let
          const constTest = true;
          let letTest = true;
          // Test async/await
          const asyncTest = async () => true;
          
          return {
            pass: true,
            message: 'All ES6+ features supported'
          };
        } catch (error) {
          return {
            pass: false,
            message: `ES6+ not fully supported: ${error.message}`
          };
        }
      }, '4.1');

      TestRunner.addTest('browser', 'Audio API support', async () => {
        createTestItem('browser', 'Audio API support', '2.2, 4.4');
        
        const hasAudio = typeof Audio !== 'undefined';
        const hasAudioContext = typeof AudioContext !== 'undefined' || 
                               typeof webkitAudioContext !== 'undefined';
        
        return {
          pass: hasAudio,
          message: hasAudio 
            ? 'Audio API supported' 
            : 'Audio API not supported'
        };
      }, '2.2, 4.4');

      TestRunner.addTest('browser', 'LocalStorage availability', async () => {
        createTestItem('browser', 'LocalStorage availability', '1.4');
        
        try {
          const testKey = '__test__';
          localStorage.setItem(testKey, 'test');
          localStorage.removeItem(testKey);
          
          return {
            pass: true,
            message: 'LocalStorage available'
          };
        } catch (error) {
          return {
            pass: false,
            message: 'LocalStorage not available'
          };
        }
      }, '1.4');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      defineTests();

      document.getElementById('run-all-btn').addEventListener('click', async () => {
        document.getElementById('run-all-btn').disabled = true;
        await TestRunner.runAll();
        document.getElementById('run-all-btn').disabled = false;
      });

      document.getElementById('clear-btn').addEventListener('click', () => {
        location.reload();
      });

      TestRunner.log('Test suite ready. Click "Run All Tests" to begin.', 'info');
    });
  </script>
</body>
</html>
